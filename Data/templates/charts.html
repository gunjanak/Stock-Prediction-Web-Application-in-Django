<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=decive-width, initial-scale=1.0">
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js"></script>
<script
  src="https://code.jquery.com/jquery-3.6.4.min.js"
  integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8="
  crossorigin="anonymous">
</script>
<!-- Include Chart.js from CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-v4-grid-only@1.0.0/dist/bootstrap-grid.min.css">
        <title>Dropdown Menu</title>
    </head>


    <body>
        <select id="stockDropdown" onchange="getData()">

        </select>
        <!-- Element to display the JSON response -->
        <div id="jsonData"></div>
        <!-- Create a canvas element for the chart -->

        <canvas id="lineChart" width="300" height="100"></canvas>
        


        <script>
            


            const ctx = document.getElementById('lineChart');
  
            const newLineChart = new Chart(ctx, {
                type: 'line',
                data: {
                labels: [],
                datasets: [{
                    label: '',
                    data: [],
                    borderWidth: 3
                },
                {
                    label: '',
                    data: [],
                    borderWidth: 3
                },

            ]
                },
                options: {
                scales: {
                    y: {
                    beginAtZero: false
                    }
                }
                }
            });

            //Function to populate the Dropdown with options
            function populateDropdown(){
                //Fetch the JSON response from the view
                fetch('/symbols/')
                .then(response => response.json())
                .then(data => {
                    //Get the dropdown element
                    var dropdown = document.getElementById("stockDropdown");

                    //Iterate over the sotcks array in the JSON response
                    for(var i=0;i<data.stocks.length; i++){
                        //create a new option element
                        var option = document.createElement("option");

                        //set the value and text of the option
                        option.value = data.stocks[i];
                        option.text = data.stocks[i];

                        //Append the option to the dropdown
                        dropdown.appendChild(option);
                    }
                    // Trigger getData() initially to fetch data for the default selected option
                getData();
                })
                .catch(error => console.error('Error: ',error));
            }

            //Function to get data based on the selected symbol

            function getData(){
                //Get the selected value from the dropdown
                var selectedSymbol = document.getElementById("stockDropdown").value;
                //construct the URL with the selected symbol
                var apiUrl = '/stock/' + selectedSymbol + '/';

                //Make an asynchronous request to the Django view
                fetch(apiUrl).then(response => response.json())
                .then(json => {
                    // console.log(json);
                    //Display the JSON response
                    document.getElementById("jsonData").innerText = JSON.stringify(json,null,2);
                    // console.log(jsonData);
                    drawChart(newLineChart,json);
                    


                })
                .catch(error => console.error('Error: ',error));
                
            }

           


              // Call the function to populate the dropdown when the page loads
    window.onload = populateDropdown;
        </script>

<script>
    

    function drawChart(chart,jsonData){
                console.log("fuck");
                // console.log(jsonData);
                console.log(chart.data.datasets[0].label);
                const title = jsonData.title;
                const labels = jsonData.data.labels;
                const datasets = jsonData.data.datasets;
                // console.log(datasets[1]);



                chart.title = title;
                chart.data.labels = labels;
                chart.data.datasets[0].label = datasets[0].label;
                chart.data.datasets[0].data = datasets[0].data;
                chart.data.datasets[1].label = datasets[1].label;
                chart.data.datasets[1].data = datasets[1].data;

                chart.update();
            }

    
  </script>
  




       
    </body>
</html>